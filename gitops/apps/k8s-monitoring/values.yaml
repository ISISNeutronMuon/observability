cluster:
  name: observability

destinations:
  - name: metrics-service
    type: prometheus
    url: https://mimir.observability.isis.rl.ac.uk/observability/api/v1/push
    auth:
      type: basic
      usernameKey: username
      passwordKey: password
    secret:
      create: false
      name: mimir-basic-auth
      namespace: monitoring

  - name: logs-service
    type: loki
    url: https://loki.observability.isis.rl.ac.uk/observability/loki/api/v1/push
    auth:
      type: basic
      usernameKey: username
      passwordKey: password
    secret:
      create: false
      name: loki-basic-auth
      namespace: monitoring

  - name: traces-service
    type: otlp
    url: https://tempo.observability.isis.rl.ac.uk/observability
    auth:
      type: basic
      usernameKey: username
      passwordKey: password
    secret:
      create: false
      name: tempo-basic-auth
      namespace: monitoring
    metrics: {enabled: true}
    logs: {enabled: true}
    traces: {enabled: true}

annotationAutodiscovery:
  enabled: true
  namespaces: [loki, mimir, tempo, grafana, vault-op, argocd, envoy-gateway-system]

applicationObservability:
  enabled: false
  receivers:
    otlp:
      grpc:
        enabled: true
  metrics:
    filters:
      metric:
        - not(IsMatch(resource.attributes["k8s.namespace.name"], "^loki|mimir|tempo|grafana|vault-op|argocd|envoy-gateway-system$"))
      logs:
        - not(IsMatch(resource.attributes["k8s.namespace.name"], "^loki|mimir|tempo|grafana|vault-op|argocd|envoy-gateway-system$"))
      traces:
        - not(IsMatch(resource.attributes["k8s.namespace.name"], "^loki|mimir|tempo|grafana|vault-op|argocd|envoy-gateway-system$"))

autoInstrumentation:
  enabled: true
  beyla:
    config:
      data:
        discovery:
          services:
            - k8s_namespace: loki
            - k8s_namespace: mimir
            - k8s_namespace: tempo
            - k8s_namespace: grafana
            - k8s_namespace: vault-op
            - k8s_namespace: argocd
            - k8s_namespace: envoy-gateway-system

clusterEvents:
  enabled: true
  namespaces: [loki, mimir, tempo, grafana, vault-op, argocd, envoy-gateway-system]

clusterMetrics:
  enabled: true
  cadvisor:
    metricsTuning:
      includeNamespaces: [loki, mimir, tempo, grafana, vault-op, argocd, envoy-gateway-system]
  kube-state-metrics:
    namespaces: [loki, mimir, tempo, grafana, vault-op, argocd, envoy-gateway-system]

podLogs:
  enabled: true
  namespaces: [loki, mimir, tempo, grafana, vault-op, argocd, envoy-gateway-system]

profiling:
  enabled: false
  ebpf:
    namespaces: [loki, mimir, tempo, grafana, vault-op, argocd, envoy-gateway-system]
  java:
    namespaces: [loki, mimir, tempo, grafana, vault-op, argocd, envoy-gateway-system]
  pprof:
    namespaces: [loki, mimir, tempo, grafana, vault-op, argocd, envoy-gateway-system]

prometheusOperatorObjects:
  enabled: true
  probes:
    namespaces: [loki, mimir, tempo, grafana, vault-op, argocd, envoy-gateway-system]
  podMonitors:
    namespaces: [loki, mimir, tempo, grafana, vault-op, argocd, envoy-gateway-system]
  serviceMonitors:
    namespaces: [loki, mimir, tempo, grafana, vault-op, argocd, envoy-gateway-system]

alloy-metrics:
  enabled: true

alloy-singleton:
  enabled: true

alloy-logs:
  enabled: true

alloy-receiver:
  enabled: true
  alloy:
    extraPorts:
      - name: otlp-grpc
        port: 4317
        targetPort: 4317
        protocol: TCP

alloy-profiles:
  enabled: false
